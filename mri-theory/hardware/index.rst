MRI Hardware
============

Overview
--------

- Magnet types: superconducting, permanent, resistive; cryostat & cryogens
- Gradient coils, gradient amplifiers, slew rate, active shielding
- RF chain: body transmit, surface/array receive coils, pre-amps, T/R switches
- Shim coils (passive & active)
- Console electronics: waveform generators, ADC/DAC, clocks
- Patient table, positioning, physiological gating hardware
- RF shielding, magnetic shielding, cryogenic venting, Faraday cage
- Safety subsystems: quench pipe, interlocks, SAR/DB1 monitors

.. note::

   1 liter of liquid helium costs as much as good whiskey (analogy) — around 50 pounds.

**Kuprov**


Main magnet and shielding
-------------------------

Shim systems
------------

Even 0.01% deviation in current can lead to 20 ppm inhomogeneity in 7T.

Subject inhomogeneity (from humans):

- small (< 2 ppm)
- subject-dependent
- mostly static
- dynamic (breathing and motion)

.. math::

   B_{0,\ \text{material}} = (1 + \lambda)\, B_{0,\ \text{vacuum}}

- :math:`\lambda`: magnetic susceptibility
- :math:`\lambda < 0`: diamagnetic (water, copper)
- :math:`\lambda > 0`: paramagnetic (air, niobium)
- :math:`\lambda \gg 0`: ferromagnetic (iron, nickel)

Magnetic field in each of those materials, taken **separately**, would still be **homogeneous**; however, inhomogeneities arise where two materials with different susceptibilities meet. Air–water interfaces give the biggest disturbances in magnetic field, which is typical for humans (nose and ear canals with air, other parts with water).

**Shimming** is the process of adding magnetic fields to cancel inhomogeneities.

Mathematically, the inhomogeneous field can be approximated by the homogeneous field we want plus a sum of inhomogeneity terms described by basis functions (commonly spherical harmonic functions). The more terms available, the better the approximation; in practice, most scanners implement first- and second-order harmonics.

Nice property: spherical harmonic fields can be generated **inside the magnet** using specifically designed coils.

- First-order fields are generated by X, Y, Z gradient coils.
- Second-order fields are generated by at least five additional coils.
- Spherical harmonic shim coils are typically superconducting.

.. math::

   \frac{dt}{dv}


Gradient coils
--------------

Primary function
^^^^^^^^^^^^^^^^

- Encode spatial information:
  - Slice selection
  - Phase encoding
  - Frequency encoding

Secondary functions
^^^^^^^^^^^^^^^^^^^

- Spin de-phasing to minimize artifacts
- Spin re-phasing after slice selection
- Spin pre-phasing before readout
- Sensitize/de-sensitize images to motion

Gradients are a special kind of inhomogeneous magnetic field where the **z-component** varies linearly along a specific direction. For all X, Y, Z gradients, the magnetic field component produced by the gradient points strictly along :math:`\hat{k}` (the :math:`z`-axis). Gradients are **not** fields perpendicular to :math:`B_0`; otherwise, the net field would be a vector sum leading to an oblique gradient.

.. math::

   B_{G_z}(x) = G_x\, x

Where:

- :math:`B`: magnetic field from the gradient
- :math:`G_z`: points along :math:`z`
- :math:`(x)`: varies with :math:`x`
- :math:`G_x`: X-gradient amplitude
- :math:`x`: position relative to isocenter

More generally, with position vector :math:`\vec{r}`:

.. math::

   B_{G_z}(\vec{r}, t) = \big(G_x(t)\,x + G_y(t)\,y + G_z(t)\,z\big)\,\hat{k}
                       = \big(\vec{G}(t)\cdot \vec{r}\big)\,\hat{k}

   \vec{B}(\vec{r}, t) = \big(B_0 + B_{G_z}\big)\,\hat{k}
                       = \big(B_0 + \vec{G}(t)\cdot \vec{r}\big)\,\hat{k}

Larmor frequency of a nucleus at position :math:`\vec{r}` is:

.. math::

   \omega = \gamma \big(\vec{B}_0 + \vec{B}(\vec{r})\big)

Because :math:`B_0` is orders of magnitude stronger than gradient fields, the Larmor frequency is governed mainly by :math:`B_z(\vec{r})`, with perpendicular components negligible:

.. math::

   \big|\vec{B}(\vec{r}_0)\big|
   = \sqrt{\big(B_0 + B_z(\vec{r}_0)\big)^2 + B_x^2(\vec{r}_0) + B_y^2(\vec{r}_0)}
   \approx \big|B_0 + B_z(\vec{r}_0)\big|

Ideal gradient coil requirements (constant spatial derivative):

.. math::

   G_x(\vec{r}) = \frac{\partial B_z}{\partial x} = \text{const}, \quad
   G_y(\vec{r}) = \frac{\partial B_z}{\partial y} = \text{const}, \quad
   G_z(\vec{r}) = \frac{\partial B_z}{\partial z} = \text{const}

These can be met only within a **finite** region, the linearity volume (**LV**), often specified as the diameter of a spherical volume (**DSV**) with linearity radius :math:`r_{LV}`. A key design goal is to maximize DSV.

Another challenge is **eddy currents** induced in conductive structures by time-varying fields (Faraday’s law). A common solution is a **secondary shielding coil** placed outside the main gradient coil (actively shielded gradients).

Design methods:

- Gradient descent
- Least-squares methods
- Simulated annealing

Z gradient
^^^^^^^^^^

- Maxwell pair coil
- Linear B-field variation along :math:`z`
- Highly uniform in the :math:`xy` plane
- Currents are equal and opposite

XY gradients
^^^^^^^^^^^^

- Saddle/Golay coil pairs
- Linear B-field variation along :math:`x` or :math:`y`
- Highly uniform in the :math:`yz` or :math:`xz` plane
- Innermost turns produce the gradient field


RF chain
--------

.. epigraph::

   RF coils are the lenses of the MRI system.

RF must produce a time-varying excitation :math:`B_1(t)` with:

- Components that rotate near the resonant frequency :math:`\omega_0`
- Components perpendicular to the static field :math:`B_0`

Progression of coil types:

- Single loop (simplest) → Helmholtz (2-coil) → :math:`N`-coil (solenoid)

These are **linearly polarized** (LP): :math:`B_1` oscillates in one dimension, so only half the energy couples to the spins.

They are replaced in many transmit applications by **quadrature** / **CP** (circularly polarized) coils (two orthogonal fields). LP coils remain widely used as **receive-only** coils; quadrature detection improves SNR by a factor of :math:`\sqrt{2}`.

General RF coil design goals:

- Maximize transmit :math:`B_1^+` within the sample per unit input current
- Minimize electric field :math:`E` within the sample per unit input current
- For volume coils, achieve homogeneous :math:`B_1^+` over as large a volume as possible

Flip angle:

.. math::

   \alpha = \gamma\, B_1^+\, \tau

For a given flip angle, increasing :math:`B_1^+` shortens the pulse duration :math:`\tau`, which helps minimize off‑resonance artifacts.

Sample power absorption:

.. math::

   P_{\text{abs}} = \frac{1}{2} \int \sigma\, \lvert E \rvert^2 \, \mathrm{d}v

Where :math:`\sigma` is conductivity and :math:`v` is sample volume.


Electronics
-----------

(Placeholder for console electronics, waveform generators, ADC/DAC, clocks, T/R switches, pre-amps, and synchronization/clocking subsystems.)
